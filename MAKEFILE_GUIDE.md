📋 MAKEFILE COMMANDS - Полный справочник команд

═══════════════════════════════════════════════════════════════════════════════

🎯 ОСНОВНЫЕ КОМАНДЫ:

make                    Собрать проект (стандартная оптимизация)
make run                Собрать и сразу запустить сервер
make clean              Удалить все скомпилированные файлы
make help               Показать эту справку

═══════════════════════════════════════════════════════════════════════════════

🔧 КОМАНДЫ ОТЛАДКИ:

make debug              Собрать с информацией для отладки (-g -O0)
                        + DEBUG_LOG=1, DEBUG_MEMORY=1
                        
make debug-run          Собрать с дебагом и сразу запустить
                        Полезно для поиска ошибок

═══════════════════════════════════════════════════════════════════════════════

📊 КОМАНДЫ ПРОФИЛИРОВАНИЯ:

make profile            Собрать с профилированием (-pg флаг)
                        Создаёт файл gmon.out при выполнении

Анализ профиля:
```bash
make profile
./build/server  # Запустить и выключить (Ctrl+C)
gprof ./build/server gmon.out
```

═══════════════════════════════════════════════════════════════════════════════

📈 КОМАНДЫ ИНФОРМАЦИИ:

make stats              Показать статистику проекта:
                        - Количество строк кода
                        - Опции компилятора
                        - Описание оптимизаций

═══════════════════════════════════════════════════════════════════════════════

🔨 ДЕТАЛЬНЫЕ КОМАНДЫ:

make %.o                Скомпилировать отдельный файл
Пример: make src/main.o

═══════════════════════════════════════════════════════════════════════════════

💡 ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ:

РАЗРАБОТКА:
```bash
# Быстрая разработка с дебагом
make debug-run

# Изменили код, пересобрали
make clean && make

# Запустили
./build/server
```

PRODUCTION:
```bash
# Оптимальная сборка для production
make clean && make

# Запустить
./build/server

# Или в фоне (Linux)
nohup ./build/server > server.log 2>&1 &
```

ПРОФИЛИРОВАНИЕ:
```bash
# Найти узкие места
make profile
./build/server  # Отработает, затем Ctrl+C
gprof ./build/server gmon.out | head -30
```

═══════════════════════════════════════════════════════════════════════════════

⚙️ ОПЦИИ КОМПИЛЯТОРА (используются в Makefile):

ОСНОВНЫЕ:
  -Wall              Все предупреждения
  -Wextra            Дополнительные предупреждения
  -I./include        Включить директорию с заголовками

ОПТИМИЗАЦИЯ:
  -O3                Максимальная оптимизация (для production)
  -O0                Без оптимизации (для debug)
  -march=native      Оптимизировать под текущий CPU
  -flto              Link-Time Optimization (+15% скорость)
  -ffast-math        Быстрая математика (не полностью IEEE)
  -ftree-vectorize   Векторизация циклов
  -fomit-frame-pointer Убрать frame pointer (экономия памяти)
  -finline-functions Встроить функции

ОТЛАДКА:
  -g                 Включить информацию для отладчика
  -pg                Профилирование (gprof)

ОПРЕДЕЛЕНИЯ:
  -DNDEBUG           Отключить assert() (product)
  -DEBUG_LOG=1       Включить логирование (debug)
  -DEBUG_MEMORY=1    Включить отладку памяти (debug)

═══════════════════════════════════════════════════════════════════════════════

🔗 ОПЦИИ ЛИНКОВКИ (используются в Makefile):

ОСНОВНЫЕ:
  -lm                 Linkить math library
  -lpthread           Linkить pthread library

ОПТИМИЗАЦИЯ:
  -Wl,-O3             Оптимизировать линковку
  -Wl,--sort-common   Сортировать common символы
  -Wl,--as-needed     Linkить только нужные libraries

РЕЗУЛЬТАТ:
  ~20% быстрее выполнения, ~5% меньше размер файла

═══════════════════════════════════════════════════════════════════════════════

📝 ПЕРЕМЕННЫЕ В MAKEFILE:

CC                  Компилятор (gcc)
CFLAGS              Флаги компилятора
LDFLAGS             Флаги линковки
SOURCES             Список исходных файлов (.c)
OBJECTS             Список объектных файлов (.o)
OUTPUT              Выходной исполняемый файл

ИЗМЕНЕНИЕ:
```bash
# Использовать другой компилятор
make CC=clang

# Добавить флаги
make CFLAGS="-O2 -Wall"

# Изменить выходной файл
make OUTPUT=build/minecraft_server
```

═══════════════════════════════════════════════════════════════════════════════

🎯 ЦЕЛЕВЫЕ ПЛАТФОРМЫ:

Linux:
```bash
make clean && make -j$(nproc)
make run
```

macOS:
```bash
make clean && make -j$(sysctl -n hw.ncpu)
make run
```

Windows (MSYS2):
```bash
make clean && make -j4
.\build\server.exe
```

Windows (WSL):
```bash
make clean && make -j$(nproc)
./build/server
```

═══════════════════════════════════════════════════════════════════════════════

⚡ ПРОИЗВОДИТЕЛЬНОСТЬ КОМПИЛЯЦИИ:

Быстрая:
```bash
make -j$(nproc)      # Максимум ядер CPU (Linux/macOS)
make -j4              # 4 ядра (Windows)
```

Результат: ~3-5 сек (вместо 10-15 сек последовательно)

═══════════════════════════════════════════════════════════════════════════════

🐛 ОТЛАДКА СБОРКИ:

Показать выполняемые команды:
```bash
make -n              # Показать что будет выполнено (dry run)
make -n clean        # Показать что удалит clean
```

Подробные логи:
```bash
make V=1             # Verbose mode (показать все команды)
make --debug=b       # Дебаг информация от make
```

═══════════════════════════════════════════════════════════════════════════════

📊 ИНФОРМАЦИЯ О ПРОЕКТЕ (make stats):

```
Статистика проекта:
- Количество строк кода (wc -l)
- Список файлов

Опции компилятора:
- -O3: максимальная оптимизация
- -march=native: оптимизация под текущий процессор
- -flto: Link-Time Optimization
- -ffast-math: быстрая математика
- -ftree-vectorize: векторизация кода
- -fomit-frame-pointer: убрать frame pointer
```

═══════════════════════════════════════════════════════════════════════════════

⚠️ ЧАСТЫЕ ОШИБКИ И РЕШЕНИЯ:

ОШИБКА: "No rule to make target `build/server`"
✅ РЕШЕНИЕ:
   1. Убедитесь что существует build/ директория
   2. make clean && make
   3. Проверьте что все .c файлы есть в src/

ОШИБКА: "undefined reference to `..."
✅ РЕШЕНИЕ:
   1. Проверьте что файл включён в SOURCES
   2. Проверьте что функция задекларирована в .h
   3. make clean && make

ОШИБКА: "permission denied ./build/server" (Linux)
✅ РЕШЕНИЕ:
   chmod +x ./build/server
   ./build/server

═══════════════════════════════════════════════════════════════════════════════

🔄 ПОЛНЫЙ ЦИКЛ РАЗРАБОТКИ:

1. Внесите изменения в исходный код

2. Проверьте синтаксис:
   make clean

3. Пересоберите:
   make

4. Протестируйте:
   ./build/server

5. Если есть ошибки, используйте дебаг:
   make debug && ./build/server

6. Для production используйте:
   make clean && make && ./build/server

═══════════════════════════════════════════════════════════════════════════════

📦 РАЗМЕРЫ ФАЙЛОВ:

Release сборка:
- build/server       ~512 KB
- Оптимизирован, без отладки

Debug сборка:
- build/server       ~2-3 MB
- С информацией для отладчика

Profile сборка:
- build/server       ~1-2 MB
- С информацией для gprof

═══════════════════════════════════════════════════════════════════════════════

🎯 РЕКОМЕНДУЕМЫЕ КОМАНДЫ:

НОВИЧКОВ:
```bash
make run              # Всё просто
```

РАЗРАБОТЧИКОВ:
```bash
make clean && make debug-run   # Развивай и дебажь
```

АДМИНИСТРАТОРОВ:
```bash
make clean && make             # Production сборка
```

ОПТИМИЗАТОРОВ:
```bash
make profile && ./build/server # Профилируй и анализируй
```

═══════════════════════════════════════════════════════════════════════════════

💡 СОВЕТЫ:

1. Всегда используйте `make clean && make` при большой правке
2. Используйте `make -j$(nproc)` для быстрой сборки
3. Для debug используйте `make debug-run`
4. Для production используйте обычный `make`
5. Смотрите `make help` если забыли команду

═══════════════════════════════════════════════════════════════════════════════

✨ ДОПОЛНИТЕЛЬНЫЕ СКРИПТЫ:

Linux/macOS:
```bash
bash build.sh        # Автоматическая сборка
```

Windows:
```bash
build.bat            # Автоматическая сборка
```

═══════════════════════════════════════════════════════════════════════════════

Версия: 1.0.0
Дата создания: 12 ноября 2025
